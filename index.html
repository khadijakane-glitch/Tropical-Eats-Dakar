<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tropical Eats Dakar - Alimentation Saine & Fraîche</title>
  <link rel="icon" href="https://example.com/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#19A974',       // Green
            secondary: '#F9A825',     // Yellow
            background: '#FFFBEA',    // Off-white
            textDark: '#333333',
            coral: '#FF7F50',
            darkGreen: '#0F8A5F',
          },
          fontFamily: {
            poppins: ['Poppins', 'sans-serif'],
          },
        },
      },
    };
  </script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #FFFBEA;
    }
    .hero-pattern {
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2319a974' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
    }
    .nav-link {
      position: relative;
      color: #333333;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #F9A825;
      transition: width 0.3s ease;
    }
    .nav-link:hover::after {
      width: 100%;
    }
    .category-card:hover, .product-card:hover {
      transform: translateY(-5px);
      transition: transform 0.3s ease;
    }
    .product-card:hover {
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .text-primary {
      color: #19A974;
    }
    .bg-primary {
      background-color: #19A974;
    }
    .bg-secondary {
      background-color: #F9A825;
    }
    .text-secondary {
      color: #F9A825;
    }
    .hover\\:bg-darkGreen:hover {
      background-color: #0F8A5F;
    }
    .hover\\:text-primary:hover {
      color: #19A974;
    }
  </style>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="hero-pattern font-poppins">

<!-- Header -->
<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3 flex justify-between items-center">
    <!-- Logo & Brand -->
    <div class="flex items-center space-x-2" aria-label="Tropical Eats Dakar logo">
      <svg viewBox="0 0 100 100" width="40" height="40" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" role="img" >
        <!-- Sun -->
        <circle cx="50" cy="48" r="19" fill="#F9A825"/>
        <!-- Sun rays -->
        <g stroke="#F9A825" stroke-width="2">
          <line x1="50" y1="20" x2="50" y2="5"/>
          <line x1="65" y1="23" x2="72" y2="11"/>
          <line x1="77" y1="35" x2="90" y2="29"/>
          <line x1="80" y1="48" x2="95" y2="48"/>
          <line x1="77" y1="61" x2="90" y2="67"/>
          <line x1="65" y1="73" x2="73" y2="87"/>
          <line x1="50" y1="76" x2="50" y2="92"/>
          <line x1="35" y1="73" x2="27" y2="87"/>
          <line x1="23" y1="61" x2="10" y2="67"/>
          <line x1="20" y1="48" x2="5" y2="48"/>
          <line x1="23" y1="35" x2="10" y2="29"/>
          <line x1="35" y1="23" x2="27" y2="11"/>
        </g>
        <!-- Leaves -->
        <path d="M15,70 Q50,100 85,70 Q68,75 50,60 Q32,75 15,70 Z" fill="#19A974"/>
        <path d="M50,60 Q65,73 75,70 Q65,67 50,60 Q35,67 25,70 Q35,73 50,60 Z" fill="#43A047"/>
        <!-- Leaf veins -->
        <path d="M50,60 Q52,80 70,75" stroke="#fff" stroke-width="2" fill="none"/>
        <path d="M50,60 Q48,80 30,75" stroke="#fff" stroke-width="2" fill="none"/>
      </svg>
      <span class="text-2xl font-bold text-primary select-none">Tropical Eats Dakar</span>
    </div>

    <!-- Navigation -->
    <nav class="hidden md:flex space-x-8 text-textDark font-medium">
      <a href="#" class="nav-link hover:text-primary">Accueil</a>
      <a href="#categories" class="nav-link hover:text-primary">Catégories</a>
      <a href="#about" class="nav-link hover:text-primary">À propos</a>
      <a href="#blog" class="nav-link hover:text-primary">Blog</a>
      <a href="#contact" class="nav-link hover:text-primary">Contact</a>
      <a href="admin.html" class="nav-link text-secondary hover:text-yellow-400 font-semibold">Admin</a>
    </nav>

    <!-- Cart icon -->
    <div class="hidden md:flex items-center relative">
      <button id="cart-button" aria-label="Panier" class="bg-secondary text-white rounded px-3 py-1 relative font-semibold hover:bg-yellow-500 transition">
        Panier
        <span id="cart-count" class="absolute -top-2 -right-2 bg-yellow-600 rounded-full w-5 h-5 flex items-center justify-center text-xs select-none">0</span>
      </button>
    </div>
  </div>
</header>

<!-- Categories Section -->
<section id="categories" class="py-12 container mx-auto px-4">
  <h2 class="text-3xl font-bold mb-8 text-textDark text-center">Découvrez nos catégories</h2>
  <div id="categories-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
</section>

<!-- Products Section for selected category -->
<section id="products-section" class="py-12 container mx-auto px-4 hidden">
  <button id="back-to-categories" class="mb-6 text-primary font-semibold hover:underline">&larr; Retour aux catégories</button>
  <h3 id="products-category-title" class="text-2xl font-bold mb-6 text-primary"></h3>
  <div id="products-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-10"></div>
</section>

<!-- Cart and Checkout Modal -->
<div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 hidden" aria-hidden="true">
  <div class="bg-white rounded-lg shadow-lg max-w-lg w-full max-h-[90vh] overflow-auto p-6 relative" role="dialog" aria-modal="true" aria-labelledby="cart-title">
    <button id="close-cart" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800" aria-label="Fermer le panier">&times;</button>
    <h3 id="cart-title" class="text-2xl font-bold mb-4 text-primary">Votre Panier</h3>
    <div id="cart-items" class="mb-4 text-textDark"></div>

    <div class="mb-4">
      <label for="delivery-distance" class="block font-semibold mb-1">Distance de livraison (km):</label>
      <input type="number" id="delivery-distance" min="0" value="0" class="border p-2 rounded w-full" />
      <p id="delivery-fee" class="mt-1 font-semibold text-textDark">Frais de livraison: 0 CFA</p>
    </div>

    <h4 class="font-semibold mb-2">Choisissez le mode de paiement :</h4>
    <div id="payment-methods" class="mb-4 space-y-2 text-textDark">
      <label><input type="radio" name="payment" value="card" checked> Carte bancaire (Stripe Test)</label><br>
      <label><input type="radio" name="payment" value="orange-money"> Orange Money (à venir)</label><br>
      <label><input type="radio" name="payment" value="wave"> Wave (à venir)</label><br>
      <label><input type="radio" name="payment" value="cod"> Paiement à la livraison (Cash on Delivery)</label>
    </div>

    <!-- Stripe Card Element Container -->
    <div id="card-element" class="mb-4"></div>
    <div id="card-errors" role="alert" class="text-red-600 mb-4"></div>

    <button id="checkout-btn" class="bg-primary text-white px-6 py-2 rounded hover:bg-darkGreen transition w-full font-semibold">Valider la commande</button>
  </div>
</div>

<!-- Contact Section -->
<section id="contact" class="py-16 bg-background">
  <div class="container mx-auto px-4 max-w-2xl text-center">
    <h2 class="text-3xl font-bold text-textDark mb-4">Contactez-nous</h2>
    <p class="text-gray-700 mb-6">Pour questions, commandes ou collaborations, contactez-nous via WhatsApp, email, ou rendez-nous visite en magasin.</p>
    <div class="space-y-3">
      <a href="https://wa.me/xxxxxxxxxx" target="_blank" rel="noopener noreferrer" class="inline-block bg-primary hover:bg-darkGreen text-white py-3 px-6 rounded-full transition duration-300">WhatsApp</a>
      <a href="mailto:contact@tropicaleatsdakar.sn" class="inline-block border-2 border-primary text-primary hover:bg-primary hover:text-white py-3 px-6 rounded-full transition duration-300">Email</a>
      <p class="text-textDark mt-4 select-none">Adresse: Dakar, Sénégal</p>
      <iframe 
          src="https://maps.google.com/maps?q=Dakar%2C%20Senegal&t=&z=13&ie=UTF8&iwloc=&output=embed" 
          frameborder="0" 
          class="w-full h-48 rounded-lg mt-4" 
          aria-label="Carte de la localisation Tropical Eats Dakar" 
          allowfullscreen="">
      </iframe>
    </div>
  </div>
</section>

<script>
  // -----------------------
  // Categories & Products data
  // -----------------------
  const categories = [
    { 
      name: 'Boosters', 
      description: 'Shots d\'immunité et mélanges énergétiques', 
      products: []
    },
    { 
      name: 'Candy', 
      description: 'Bonbons et friandises saines', 
      products: [] 
    },
    { 
      name: 'Cold-pressed oils', 
      description: 'Huiles pressées à froid', 
      products: [] 
    },
    { 
      name: 'Detox', 
      description: 'Produits detox', 
      products: [] 
    },
    { 
      name: 'Dried Fruits', 
      description: 'Fruits secs', 
      products: [] 
    },
    { 
      name: 'Fresh Juices', 
      description: 'Jus frais naturels et sains', 
      products: [
        { id: 'bissap', name: 'Bissap', price: 1200, stock: 20, image: 'https://example.com/images/bissap.jpg' },
        { id: 'bouye-mandarine', name: 'Bouye mandarine', price: 2000, stock: 20, image: 'https://example.com/images/bouye.jpg' },
        { id: 'cucumber-lemonade', name: 'Cucumber lemonade', price: 2000, stock: 20, image: 'https://example.com/images/cucumber.jpg' },
        { id: 'ginger-juice', name: 'Ginger juice', price: 2000, stock: 20, image: 'https://example.com/images/ginger.jpg' },
        { id: 'grapefruit-lemonade', name: 'Grapefruit lemonade', price: 1800, stock: 20, image: 'https://example.com/images/grapefruit.jpg' },
        { id: 'mango-cocktail', name: 'Mango cocktail', price: 1500, stock: 20, image: 'https://example.com/images/mango.jpg' },
        { id: 'moringa-juice', name: 'Moringa juice', price: 1700, stock: 20, image: 'https://example.com/images/moringa.jpg' },
        { id: 'sweet-green-juice', name: 'Sweet green juice', price: 1400, stock: 20, image: 'https://example.com/images/sweet-green.jpg' },
        { id: 'tamarind-juice', name: 'Tamarind juice', price: 2200, stock: 20, image: 'https://example.com/images/tamarind.jpg' },
      ]
    },
    { 
      name: 'Healthy Snacks', 
      description: 'Snacks sains à grignoter', 
      products: [] 
    },
    { name: 'Popsicles', description: 'Glaces artisanales', products: [] },
    { name: 'Spices', description: 'Épices naturelles', products: [] },
    { name: 'Syrups', description: 'Sirops naturels', products: [] },
    { name: 'Vegan Milk', description: 'Laits végétaux', products: [] },
    { name: 'Wellness', description: 'Produits bien-être', products: [] },
  ];

  // -----------------------
  // LOCAL STORAGE Helpers for stock and cart persistence
  // -----------------------
  function loadStock(){
    const savedStock = localStorage.getItem("productStock");
    if(savedStock){
      const stock = JSON.parse(savedStock);
      categories.forEach(c => {
        c.products.forEach(p => {
          if(stock.hasOwnProperty(p.id)) p.stock = stock[p.id];
        });
      });
    }
  }
  function saveStock(){
    const stockObj = {};
    categories.forEach(c => {
      c.products.forEach(p => {
        stockObj[p.id] = p.stock;
      });
    });
    localStorage.setItem("productStock", JSON.stringify(stockObj));
  }

  let cart = {};
  function loadCart(){
    const savedCart = localStorage.getItem("cart");
    if(savedCart) cart = JSON.parse(savedCart);
  }
  function saveCart(){
    localStorage.setItem("cart", JSON.stringify(cart));
  }
  function updateCartCount(){
    const count = Object.values(cart).reduce((a,b)=>a+b,0);
    document.getElementById('cart-count').textContent = count;
  }

  // -----------------------
  // UI Rendering Functions
  // -----------------------

  // Render categories as cards
  function renderCategories(){
    const container = document.getElementById('categories-container');
    container.innerHTML = '';
    categories.forEach(cat => {
      // Category card
      const card = document.createElement('div');
      card.className = "category-card bg-white p-6 rounded-xl shadow-md cursor-pointer hover:shadow-xl transition flex flex-col justify-between";
      card.tabIndex = 0; // keyboard focusable
      card.setAttribute('role', 'button');
      card.setAttribute('aria-label', `Voir les produits de la catégorie ${cat.name}`);

      card.innerHTML = `
        <h3 class="text-primary text-xl font-semibold mb-2">${cat.name}</h3>
        <p class="text-gray-700 mb-4 min-h-[3rem]">${cat.description || 'Découvrez nos produits.'}</p>
        <div class="mt-auto">
          <button class="bg-primary text-white rounded-full py-2 px-4 hover:bg-darkGreen transition" aria-hidden="true">Voir les produits</button>
        </div>
      `;

      card.onclick = () => showCategoryProducts(cat.name);
      card.onkeypress = e => { if(e.key === 'Enter' || e.key === ' ') showCategoryProducts(cat.name); };

      container.appendChild(card);
    });
  }

  // Show products for a given category
  function showCategoryProducts(categoryName){
    const section = document.getElementById('products-section');
    const productsContainer = document.getElementById('products-container');
    const title = document.getElementById('products-category-title');
    const categoriesSection = document.getElementById('categories');

    const category = categories.find(c => c.name === categoryName);
    if(!category) return;

    // Clear previous
    productsContainer.innerHTML = '';

    // Update heading
    title.textContent = category.name;

    // Build product cards grid with good spacing
    category.products.sort((a,b) => a.name.localeCompare(b.name)).forEach(prod => {
      if(!prod.stock) prod.stock = 0;
      const card = document.createElement('div');
      card.className = "product-card bg-white rounded-lg shadow p-5 flex flex-col items-center text-center max-w-xs mx-auto";
      card.innerHTML = `
        <img src="${prod.image ?? 'https://via.placeholder.com/150'}" alt="${prod.name}" class="w-48 h-48 object-cover rounded mb-4" />
        <h4 class="text-lg font-bold text-primary mb-2">${prod.name}</h4>
        <p class="text-gray-700 mb-1">Prix: <span>${prod.price} CFA</span></p>
        <p class="text-gray-600 mb-3">Stock: <span id="stock-${prod.id}">${prod.stock}</span></p>
        <div class="flex items-center gap-2">
          <label for="qty-${prod.id}" class="sr-only">Quantité pour ${prod.name}</label>
          <input type="number" id="qty-${prod.id}" min="1" max="${prod.stock}" value="1" class="border rounded w-16 p-1" aria-describedby="stock-${prod.id}" />
          <button class="bg-primary text-white px-3 py-1 rounded hover:bg-darkGreen transition" onclick="addToCart('${prod.id}')">Ajouter</button>
        </div>
      `;
      productsContainer.appendChild(card);
    });

    // Show product section, hide categories
    categoriesSection.classList.add('hidden');
    section.classList.remove('hidden');
    window.scrollTo({top: section.offsetTop - 80, behavior: 'smooth'});
  }

  // Return to categories view
  document.getElementById('back-to-categories').onclick = () => {
    document.getElementById('products-section').classList.add('hidden');
    document.getElementById('categories').classList.remove('hidden');
  };

  // Add product to cart with stock checks
  function addToCart(productId){
    const product = categories.flatMap(c => c.products).find(p => p.id === productId);
    if(!product) return alert("Produit non trouvé");
    const qtyInput = document.getElementById(`qty-${productId}`);
    let qty = parseInt(qtyInput.value, 10);
    if(isNaN(qty) || qty < 1) return alert("Entrez une quantité valide");
    const currentQty = cart[productId] || 0;
    if(currentQty + qty > product.stock) {
      return alert(`La quantité dépasse le stock disponible (${product.stock})`);
    }
    cart[productId] = currentQty + qty;
    saveCart();
    updateCartCount();
    alert(`${qty} × ${product.name} ajouté(s) au panier.`);
  }


  // -----------------------
  // Cart modal, checkout & Stripe payment same as before
  // -----------------------

  const cartButton = document.getElementById('cart-button');
  const cartModal = document.getElementById('cart-modal');
  const closeCartBtn = document.getElementById('close-cart');
  const cartItemsContainer = document.getElementById('cart-items');
  const deliveryDistanceInput = document.getElementById('delivery-distance');
  const deliveryFeeEl = document.getElementById('delivery-fee');
  const checkoutBtn = document.getElementById('checkout-btn');
  const paymentMethods = document.getElementsByName('payment');
  const cardElementDiv = document.getElementById('card-element');
  const cardErrors = document.getElementById('card-errors');

  function calculateDeliveryFee(distanceKm) {
    const feePerKm = 200; // CFA per km flat fee
    return distanceKm > 0 ? feePerKm * distanceKm : 0;
  }

  function renderCartItems(){
    cartItemsContainer.innerHTML = '';
    if(Object.keys(cart).length === 0){
      cartItemsContainer.innerHTML = '<p>Votre panier est vide.</p>';
      checkoutBtn.disabled = true;
      cardElementDiv.style.display = 'none';
      return;
    }
    checkoutBtn.disabled = false;    
    cardElementDiv.style.display = '';

    let total = 0;
    for(const [productId, qty] of Object.entries(cart)){
      const product = categories.flatMap(c => c.products).find(p => p.id === productId);
      if(!product) continue;
      const lineTotal = product.price * qty;
      total += lineTotal;

      const itemDiv = document.createElement('div');
      itemDiv.className = 'flex justify-between items-center mb-2';
      itemDiv.innerHTML = `
        <span>${qty} × ${product.name}</span>
        <span>${lineTotal} CFA</span>
        <button aria-label="Retirer un article" data-id="${productId}" class="remove-item px-2 text-red-600 hover:text-red-800">×</button>
      `;
      cartItemsContainer.appendChild(itemDiv);
    }

    const deliveryKm = parseInt(deliveryDistanceInput.value,10) || 0;
    const deliveryFee = calculateDeliveryFee(deliveryKm);
    deliveryFeeEl.textContent = `Frais de livraison: ${deliveryFee} CFA`;

    const grandTotal = total + deliveryFee;

    const totalDiv = document.createElement('div');
    totalDiv.className = 'font-bold mt-4 text-lg flex justify-between';
    totalDiv.innerHTML = `
      <span>Total (avec livraison)</span>
      <span>${grandTotal} CFA</span>
    `;
    cartItemsContainer.appendChild(totalDiv);
  }

  cartButton.addEventListener('click', () => {
    renderCartItems();
    cartModal.classList.remove('hidden');
  });
  closeCartBtn.addEventListener('click', () => {
    cartModal.classList.add('hidden');
    cardErrors.textContent = '';
    stripeCard.clear();
  });
  cartItemsContainer.addEventListener('click', e => {
    if(e.target.classList.contains('remove-item')){
      const id = e.target.getAttribute('data-id');
      if(id in cart){
        delete cart[id];
        saveCart();
        updateCartCount();
        renderCartItems();
      }
    }
  });
  deliveryDistanceInput.addEventListener('input', renderCartItems);

  // Stripe setup (replace YOUR_PUBLISHABLE_KEY_HERE with actual key)
  const stripe = Stripe('pk_test_51NOq...YOUR_PUBLISHABLE_KEY_HERE...');
  const elements = stripe.elements();
  const style = { base: { color: '#32325d', fontFamily: '"Poppins", sans-serif', fontSmoothing: 'antialiased', fontSize: '16px', '::placeholder': { color: '#a0aec0' } }, invalid: { color: '#fa755a', iconColor: '#fa755a' } };
  const stripeCard = elements.create('card', { style });
  stripeCard.mount('#card-element');
  stripeCard.on('change', e => { cardErrors.textContent = e.error ? e.error.message : ''; });

  checkoutBtn.addEventListener('click', async () => {
    if(Object.keys(cart).length === 0) {
      alert("Votre panier est vide.");
      return;
    }
    let selectedPayment = [...paymentMethods].find(pm => pm.checked)?.value || 'card';

    if(selectedPayment === 'card') {
      checkoutBtn.disabled = true;
      cardErrors.textContent = '';

      const {token, error} = await stripe.createToken(stripeCard);
      if(error) {
        cardErrors.textContent = error.message;
        checkoutBtn.disabled = false;
        return;
      }
      alert(`Paiement par carte simulé avec succès. Token: ${token.id}. Commande enregistrée.`);

      updateStockFromOrder();
      cart = {};
      saveCart();
      updateCartCount();
      cartModal.classList.add('hidden');
      stripeCard.clear();
      checkoutBtn.disabled = false;

    } else if(selectedPayment === 'cod') {
      alert('Commande passée avec paiement à la livraison. Merci !');
      updateStockFromOrder();
      cart = {};
      saveCart();
      updateCartCount();
      cartModal.classList.add('hidden');
    } else {
      alert('Options Orange Money et Wave seront intégrées bientôt.');
    }
  });

  function updateStockFromOrder(){
    for(const [pid, qty] of Object.entries(cart)){
      const product = categories.flatMap(c => c.products).find(p => p.id === pid);
      if(product) {
        product.stock = Math.max(product.stock - qty, 0);
        const stockEl = document.getElementById(`stock-${pid}`);
        if(stockEl) stockEl.textContent = product.stock;
      }
    }
    saveStock();
  }

  // Initialize page state
  loadStock();
  loadCart();
  renderCategories();
  updateCartCount();

  // Expose for admin page
  window._categories = categories;
  window._saveStock = saveStock;

</script>
</body>
</html>
